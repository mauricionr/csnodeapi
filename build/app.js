"use strict";var express=require("express"),jwt=require("jsonwebtoken"),api=express.Router(),config=require("./config"),routes=require("./routes/index");api.use(function(e,r,s){var t=e.query.token||e.body.token||e.headers["x-access-token"]||e.headers.authentication;if(!t)return r.status(401).send({mensagem:"Não autorizado"});var o="Bearer ";t=t.indexOf(o)>-1?t.substring(t.indexOf(" ")+1):t,e.token=t,jwt.verify(t,config.superSecret,function(t,o){return t?r.json({mensagem:"Falha na verificação do token"}):(e.decoded=o,void s())})}),api.route("/users/:user_id").get(routes.getById),module.exports=api;
"use strict";module.exports={teste:"não",superSecret:"superSecret",dbURL:"mongodb://localhost:27017/cs",mensagem:"mensagem de erro",expire:{expiresIn:6e4}};
"use strict";var mongoose=require("mongoose"),Schema=mongoose.Schema;module.exports=mongoose.model("User",new Schema({nome:{type:String,required:!0},email:{type:String,required:!0},senha:{type:String,required:!0},token:{type:String,required:!0},telefones:[{numero:Number,ddd:Number}],data_criacao:{type:Date,"default":Date},data_atualizacao:{type:Date,"default":Date},ultimo_login:{type:Date,"default":Date}}));
"use strict";module.exports={signIn:require("./users/sign-in"),signUp:require("./users/sign-up"),getById:require("./users/getById")};
"use strict";var User=require("../../models/user"),config=require("../../config");module.exports=function(e,r){User.findById(e.params.user_id,function(e,s){e&&r.send(config.mensagem),r.json(s)})};
"use strict";var User=require("../../models/user"),jwt=require("jsonwebtoken"),config=require("../../config"),mensagem={mensagem:"Usuário e/ou senha inválidos"};module.exports=function(e,n){User.findOne({email:e.body.email},function(s,o){s&&n.send(config.mensagem),o?o&&(o.senha!==e.body.senha?n.status(401).json(mensagem):(o.token=jwt.sign(o,config.superSecret,config.expire),o.ultimo_login=new Date,o.save(function(e,s){e&&n.send(config.mensagem),n.json(s)}))):n.json(mensagem)})};
"use strict";var User=require("../../models/user"),jwt=require("jsonwebtoken"),config=require("../../config");module.exports=function(e,n){var o=new User;o.nome=e.body.nome,o.email=e.body.email,o.senha=e.body.senha,o.telefones=e.body.telefones,User.findOne({email:e.body.email},function(e,s){e&&n.send(config.mensagem),s?n.json({menssagem:"E-mail já existente"}):(o.token=jwt.sign(o,config.superSecret,config.expire),o.save(function(e,o){e&&n.send(config.mensagem),n.json(o)}))})};